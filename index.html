<script>
    // دالة النقل الجديدة
    function moveImg(oldPath, imgId, imgUrl) {
        const targetPath = prompt("انسخ مسار القسم المستهدف من القائمة المنسدلة (مثلاً: pages/-OKjs... أو albums/-NKls...)");
        if (!targetPath) return;

        // 1. إضافة الصورة للقسم الجديد
        db.ref(DB_PATH + '/' + targetPath + '/imgs').push({ url: imgUrl }).then(() => {
            // 2. حذف الصورة من القسم القديم
            db.ref(DB_PATH + '/' + oldPath + '/imgs/' + imgId).remove();
            alert("تم نقل الصورة بنجاح");
        });
    }

    // تعديل عرض الصور في لوحة الإدارة ليشمل زر النقل
    function loadAdminImgs(p) {
        const box = document.getElementById('admin-imgs-list'); 
        if(!p) { box.innerHTML=""; return; }
        const path = p.split('/'); 
        const target = currentData[path[0]][path[1]];
        
        if(target && target.imgs) {
            box.innerHTML = Object.keys(target.imgs).reverse().map(id => {
                const imgUrl = target.imgs[id].url;
                return `
                <div style="position:relative; border:1px solid #333; border-radius:8px; overflow:hidden;">
                    <img src="${imgUrl}" style="width:100%; aspect-ratio:1/1; object-fit:cover;">
                    <div style="position:absolute; top:2px; right:2px; display:flex; gap:2px;">
                        <button onclick="moveImg('${p}', '${id}', '${imgUrl}')" style="background:#f1c40f; color:#000; border:none; border-radius:4px; cursor:pointer; padding:2px 5px;" title="نقل القسم"><i class="fas fa-exchange-alt"></i></button>
                        <button onclick="delImg('${p}/imgs/${id}')" style="background:red; color:#fff; border:none; border-radius:4px; cursor:pointer; padding:2px 5px;"><i class="fas fa-trash"></i></button>
                    </div>
                </div>`;
            }).join('');
        } else {
            box.innerHTML = "<p style='color:#666; font-size:12px;'>لا توجد صور في هذا القسم</p>";
        }
    }
</script>
