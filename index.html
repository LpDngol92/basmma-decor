<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ø¨ØµÙ…Ø© ØºÙŠØ± Ù„Ù„Ø¯ÙŠÙƒÙˆØ±</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;800;900&family=Amiri:wght@400;700&family=Lateef&family=Almarai:wght@300;400;800&family=Changa:wght@200;400;600;800&family=Lalezar&display=swap" rel="stylesheet">
    <style>
        :root {
            --font-tajawal: 'Tajawal', sans-serif;
            --font-amiri: 'Amiri', serif;
            --font-lateef: 'Lateef', serif;
            --font-almarai: 'Almarai', sans-serif;
            --font-changa: 'Changa', sans-serif;
            --font-lalezar: 'Lalezar', cursive;
            --primary: #5c0a0a;
            --gold: #c5a059;
            --bg: #0a0a0b;
            --card: rgba(20, 20, 22, 0.9);
            --green: #2ecc71;
            --red: #e74c3c;
            --text-primary: #e0e0e0;
            --text-secondary: #888;
            --border: rgba(197, 160, 89, 0.1);
            --nav-bg: rgba(10,10,11,0.95);
            --input-bg: #000;
            --input-border: #444;
            --shadow-color: rgba(0, 0, 0, 0.5);
            --about-bg: rgba(255,255,255,0.03);
            --path-bg: rgba(197, 160, 89, 0.05);
            --status-bg: rgba(255,255,255,0.03);
            --admin-bg: #111;
            --admin-section: #1a1a1c;
            --header-font: 'Tajawal', sans-serif;
        }
        
        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            margin: 0; 
            padding: 0; 
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        
        img {
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
            user-drag: none;
            pointer-events: none;
        }
        
        body { 
            font-family: var(--header-font); 
            background: var(--bg); 
            color: var(--text-primary); 
            overflow-x: hidden; 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
        }
        
        #splash { 
            position: fixed; 
            inset: 0; 
            background: #000; 
            z-index: 99999999; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            transition: opacity 0.5s ease; 
        }
        
        nav { 
            position: sticky; 
            top: 0; 
            z-index: 1000; 
            background: var(--nav-bg); 
            backdrop-filter: blur(10px); 
            padding: 12px 10px; 
            border-bottom: 1px solid var(--gold); 
            display: flex; 
            justify-content: safe center; 
            gap: 10px; 
            overflow-x: auto; 
            scrollbar-width: none; 
        }
        
        nav::-webkit-scrollbar { display: none; }
        
        .nav-btn { 
            padding: 8px 22px; 
            border: none; 
            background: rgba(255,255,255,0.05); 
            color: var(--text-secondary); 
            font-weight: 800; 
            border-radius: 40px; 
            cursor: pointer; 
            white-space: nowrap; 
            flex-shrink: 0; 
            transition: 0.3s; 
        }
        
        .nav-btn.active { 
            background: var(--primary); 
            color: #fff; 
            box-shadow: 0 0 10px rgba(92, 10, 10, 0.4); 
        }
        
        .sec { 
            width: 95%; 
            max-width: 1400px; 
            margin: 20px auto 100px; 
            display: none; 
            flex-grow: 1; 
        }
        
        .sec.active { display: block; }
        
        /* ========== ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø­Ø±Ø© ========== */
        .drawing-section {
            background: var(--card);
            border-radius: 20px;
            padding: 25px;
            margin: 30px auto;
            max-width: 1200px;
            border: 1px solid var(--border);
            box-shadow: 0 10px 30px var(--shadow-color);
        }
        
        .drawing-description {
            color: var(--text-secondary);
            margin-bottom: 25px;
            line-height: 1.6;
            text-align: center;
            font-size: 1.1rem;
            background: var(--path-bg);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid var(--border);
        }
        
        .drawing-tools {
            background: var(--input-bg);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
        }
        
        .drawing-tool-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
        }
        
        .drawing-tool-btn.active {
            background: var(--gold);
            color: #000;
            transform: scale(1.05);
        }
        
        .color-palette-drawing {
            display: flex;
            gap: 8px;
            margin: 10px 0;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .color-dot {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .color-dot:hover {
            transform: scale(1.1);
        }
        
        .color-dot.selected {
            border-color: #fff;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        
        .brush-size-control {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-primary);
            margin: 10px 0;
        }
        
        .brush-size-control input {
            width: 150px;
            margin: 0;
        }
        
        .drawing-canvas-container {
            background: #ffffff;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            position: relative;
            min-height: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: none;
            -webkit-touch-callout: none;
            user-select: auto !important;
            -webkit-user-select: auto !important;
            -moz-user-select: auto !important;
            -ms-user-select: auto !important;
        }
        
        .drawing-canvas {
            width: 100%;
            height: 600px;
            display: block;
            cursor: crosshair;
            background: #f9f9f9;
            touch-action: none;
            user-select: auto !important;
            -webkit-user-select: auto !important;
            -moz-user-select: auto !important;
            -ms-user-select: auto !important;
        }
        
        .canvas-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .drawing-action-btn {
            padding: 15px 30px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            border: none;
        }
        
        .drawing-action-btn.whatsapp {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
        }
        
        .drawing-action-btn.download {
            background: linear-gradient(135deg, var(--gold), #b8860b);
            color: #000;
        }
        
        .drawing-action-btn.clear {
            background: linear-gradient(135deg, var(--red), #c0392b);
            color: white;
        }
        
        .drawing-action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        .drawing-info {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 20px;
            text-align: center;
            padding: 15px;
            background: var(--path-bg);
            border-radius: 10px;
            border: 1px solid var(--border);
        }
        
        .shape-tools {
            display: flex;
            gap: 10px;
            margin-left: 20px;
        }
        
        .shape-btn {
            width: 40px;
            height: 40px;
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            color: var(--text-primary);
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }
        
        .shape-btn.active {
            background: var(--gold);
            color: #000;
            border-color: var(--gold);
        }
        
        .drawing-welcome {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #999;
            font-size: 1.2rem;
            pointer-events: none;
            z-index: 1;
        }
        
        footer { 
            padding: 20px; 
            text-align: center; 
            color: var(--text-secondary); 
            font-size: 0.9rem; 
            border-top: 1px solid var(--border); 
            margin-top: auto; 
        }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© */
        #protection-toggle {
            position: fixed;
            bottom: 70px;
            left: 10px;
            width: 50px;
            height: 50px;
            background: var(--green);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 200000001;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }
        
        #protection-toggle.active {
            background: var(--red);
        }
        
        #admin-panel { 
            display: none; 
            position: fixed; 
            inset: 0; 
            background: var(--admin-bg); 
            z-index: 100000000; 
            padding: 15px; 
            overflow-y: auto; 
        }
        
        .admin-box { 
            max-width: 900px; 
            margin: 20px auto; 
            background: var(--admin-bg); 
            padding: 20px; 
            border-radius: 15px; 
            border: 1px solid var(--gold); 
            color: var(--text-primary);
        }
    </style>
</head>
<body>
<div id="splash"> 
    <h2 style="color:var(--gold); font-size:2rem;">Ø¨ØµÙ…Ø© ØºÙŠØ±...</h2> 
</div>

<nav id="navbar"></nav>
<main id="content-area"></main>
<footer id="site-footer"></footer>

<button id="protection-toggle" onclick="toggleProtection()" title="ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­Ù…Ø§ÙŠØ©">
    <i class="fas fa-shield-alt"></i>
</button>

<div id="admin-panel">
    <div class="admin-box">
        <h2 style="color:var(--gold); text-align:center; margin-bottom:20px;">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
        <button onclick="location.reload()" style="width:100%; background:var(--red); color:#fff; padding:15px; border:none; margin-top:20px;">Ø®Ø±ÙˆØ¬</button>
    </div>
</div>

<div id="hidden-trigger" onclick="checkAccess()"></div>

<script>
    // ========== ØªÙ‡ÙŠØ¦Ø© Firebase ==========
    const firebaseConfig = {
        apiKey: "AIzaSyC0hGvWzpb0UxA_RrYn-0PQKyaATXavEGY",
        authDomain: "mydecor-b29bd.firebaseapp.com",
        databaseURL: "https://mydecor-b29bd-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "mydecor-b29bd",
        storageBucket: "mydecor-b29bd.firebasestorage.app",
        messagingSenderId: "302609299720",
        appId: "1:302609299720:web:e086b600c3ee824acd54bd"
    };

    firebase.initializeApp(firebaseConfig);
    
    const db = firebase.database();
    const auth = firebase.auth();
    const DB_PATH = 'site_v28';
    
    let currentData = {}; 
    let currentTab = 'home'; 
    let isAdmin = false;
    
    // ========== Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø­Ø±Ø© ==========
    let drawingCanvas, drawingCtx;
    let currentDrawingTool = 'pen';
    let currentDrawingColor = '#000000';
    let currentBrushSize = 5;
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;
    let isDrawingShape = false;
    let startX, startY;
    let currentShape = '';
    let savedDrawing = null;

    // ========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© ==========
    document.addEventListener('DOMContentLoaded', function() {
        loadData();
        setTimeout(() => {
            document.getElementById('splash').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('splash').style.display = 'none';
            }, 500);
        }, 1500);
    });

    function loadData() {
        db.ref(DB_PATH).on('value', snap => {
            currentData = snap.val() || {};
            renderAll();
            document.getElementById('site-footer').innerText = currentData.footer_text || 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© Ø¨ØµÙ…Ø© ØºÙŠØ± Ù„Ù„Ø¯ÙŠÙƒÙˆØ±';
        });
    }

    function renderAll() {
        const d = currentData;
        
        let navHtml = `<button class="nav-btn ${currentTab==='home'?'active':''}" onclick="go('home')">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>`;
        navHtml += `<button class="nav-btn ${currentTab==='catalogs'?'active':''}" onclick="go('catalogs')">Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬</button>`;
        
        if(d.drawing_active !== false) {
            navHtml += `<button class="nav-btn ${currentTab==='drawing'?'active':''}" onclick="go('drawing')">${d.drawing_button_text || 'Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø­Ø±Ø©'}</button>`;
        }
        
        if(d.pages) Object.keys(d.pages).forEach(id => navHtml += `<button class="nav-btn ${currentTab===id?'active':''}" onclick="go('${id}')">${d.pages[id].title}</button>`);
        navHtml += `<button class="nav-btn ${currentTab==='works'||currentTab.startsWith('alb-')?'active':''}" onclick="go('works')">Ø£Ø¹Ù…Ø§Ù„Ù†Ø§</button>`;
        document.getElementById('navbar').innerHTML = navHtml;
        
        let mainContent = `<section class="sec ${currentTab==='home'?'active':''}">
            <div style="text-align:center; padding:20px;">
                <h2 style="color:var(--gold); margin-bottom:20px;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ø¨ØµÙ…Ø© ØºÙŠØ± Ù„Ù„Ø¯ÙŠÙƒÙˆØ±</h2>
                <p style="color:var(--text-secondary); margin-bottom:30px;">Ù†Ù‚Ø¯Ù… Ù„ÙƒÙ… Ø£ÙØ¶Ù„ Ø­Ù„ÙˆÙ„ Ø§Ù„Ø¯ÙŠÙƒÙˆØ± ÙˆØ§Ù„ØªØ´Ø·ÙŠØ¨</p>
                <button onclick="whatsappGlobal()" class="drawing-action-btn whatsapp">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ <i class="fab fa-whatsapp"></i></button>
            </div>
        </section>`;
        
        let contentHtml = mainContent;
        
        contentHtml += `<section class="sec ${currentTab==='catalogs'?'active':''}"><div style="padding:50px; text-align:center; color:var(--text-secondary);">Ù‚Ø±ÙŠØ¨Ø§Ù‹...</div></section>`;
        
        // Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø­Ø±Ø©
        contentHtml += `
        <section class="sec ${currentTab==='drawing'?'active':''}">
            <div class="drawing-section">
                <h2 style="color:var(--gold); margin-bottom:15px; text-align:center;">${d.drawing_title || 'Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø­Ø±Ø© Ù„Ù„Ø±Ø³Ù…'}</h2>
                
                <div class="drawing-description">
                    ${d.drawing_description || 'ÙŠÙ…ÙƒÙ†Ùƒ Ù‡Ù†Ø§ Ø±Ø³Ù… ÙÙƒØ±ØªÙƒ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù„Ù„ØªØµÙ…ÙŠÙ…. Ø§Ø±Ø³Ù… Ù…Ø§ ÙŠØ¬ÙˆÙ„ Ø¨Ø®Ø§Ø·Ø±Ùƒ ÙˆØ³Ù†Ù‚ÙˆÙ… Ø¨ØªØ­ÙˆÙŠÙ„Ù‡ Ø¥Ù„Ù‰ ÙˆØ§Ù‚Ø¹!'}
                </div>
                
                <div class="drawing-tools">
                    <button class="drawing-tool-btn active" id="pen-tool" onclick="setActiveTool('pen')">
                        <i class="fas fa-pen"></i> Ù‚Ù„Ù…
                    </button>
                    <button class="drawing-tool-btn" id="eraser-tool" onclick="setActiveTool('eraser')">
                        <i class="fas fa-eraser"></i> Ù…Ù…Ø­Ø§Ø©
                    </button>
                    
                    <div class="shape-tools">
                        <button class="shape-btn" id="rect-tool" onclick="setActiveTool('rect')" title="Ù…Ø³ØªØ·ÙŠÙ„">
                            <i class="fas fa-square"></i>
                        </button>
                        <button class="shape-btn" id="circle-tool" onclick="setActiveTool('circle')" title="Ø¯Ø§Ø¦Ø±Ø©">
                            <i class="fas fa-circle"></i>
                        </button>
                        <button class="shape-btn" id="line-tool" onclick="setActiveTool('line')" title="Ø®Ø·">
                            <i class="fas fa-slash"></i>
                        </button>
                    </div>
                    
                    <div style="margin: 0 20px;">
                        <p style="color:var(--text-primary); margin-bottom:8px; text-align:center;">Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ†:</p>
                        <div class="color-palette-drawing" id="color-palette">
                            <div class="color-dot selected" onclick="selectColor('#000000')" style="background:#000;"></div>
                            <div class="color-dot" onclick="selectColor('#c5a059')" style="background:#c5a059;"></div>
                            <div class="color-dot" onclick="selectColor('#e74c3c')" style="background:#e74c3c;"></div>
                            <div class="color-dot" onclick="selectColor('#2ecc71')" style="background:#2ecc71;"></div>
                            <div class="color-dot" onclick="selectColor('#3498db')" style="background:#3498db;"></div>
                            <div class="color-dot" onclick="selectColor('#9b59b6')" style="background:#9b59b6;"></div>
                            <div class="color-dot" onclick="selectColor('#ffffff')" style="background:#ffffff; border:1px solid #ccc;"></div>
                        </div>
                    </div>
                    
                    <div class="brush-size-control">
                        <span>Ø­Ø¬Ù… Ø§Ù„Ù‚Ù„Ù…:</span>
                        <input type="range" id="brush-size" min="1" max="50" value="5" oninput="updateBrushSize(this.value)">
                        <span id="brush-size-value">5</span>
                    </div>
                </div>
                
                <div class="drawing-canvas-container">
                    <canvas id="drawing-canvas" class="drawing-canvas"></canvas>
                    <div class="drawing-welcome" id="drawing-welcome">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø³Ù… Ù‡Ù†Ø§...</div>
                </div>
                
                <div class="canvas-controls">
                    <button onclick="saveDrawingToWhatsApp()" class="drawing-action-btn whatsapp">
                        <i class="fab fa-whatsapp"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ù… Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
                    </button>
                    
                    <button onclick="downloadDrawing()" class="drawing-action-btn download">
                        <i class="fas fa-download"></i> Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ù…
                    </button>
                    
                    <button onclick="clearDrawingCanvas()" class="drawing-action-btn clear">
                        <i class="fas fa-trash"></i> Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                    </button>
                </div>
                
                <div class="drawing-info">
                    <i class="fas fa-info-circle"></i> 
                    Ø§Ù„Ø±Ø³Ù… ØºÙŠØ± Ù…Ø®Ø²Ù† Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ ÙÙ‡Ùˆ Ø®Ø§Øµ Ø¨Ùƒ ÙÙ‚Ø·. ÙŠÙ…ÙƒÙ†Ùƒ Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ù… ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡ Ø¥Ù„ÙŠÙ†Ø§ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ù…Ù†Ø§Ù‚Ø´Ø©
                </div>
            </div>
        </section>`;
        
        if(d.pages) Object.keys(d.pages).forEach(id => contentHtml += `<section class="sec ${currentTab===id?'active':''}"><div style="padding:50px; text-align:center; color:var(--text-secondary);">Ù‚Ø±ÙŠØ¨Ø§Ù‹...</div></section>`);
        contentHtml += `<section class="sec ${currentTab==='works'?'active':''}"><div style="padding:50px; text-align:center; color:var(--text-secondary);">Ù‚Ø±ÙŠØ¨Ø§Ù‹...</div></section>`;
        
        document.getElementById('content-area').innerHTML = contentHtml;
        
        // ØªÙ‡ÙŠØ¦Ø© Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ø³Ù… Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù‡Ùˆ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø­Ø±Ø©
        if(currentTab === 'drawing') {
            setTimeout(initDrawingCanvas, 100);
        }
    }

    function go(id) { 
        currentTab=id; 
        renderAll(); 
        window.scrollTo(0,0); 
    }

    function whatsappGlobal() { 
        window.open(`https://wa.me/${currentData.whatsapp_num || '966500000000'}?text=${encodeURIComponent('Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ Ø£ÙˆØ¯ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø¨ØµÙ…Ø© ØºÙŠØ± Ù„Ù„Ø¯ÙŠÙƒÙˆØ±.')}`, '_blank'); 
    }

    // ========== Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø­Ø±Ø© Ø§Ù„Ù…Ø­Ø³Ù† ==========
    function initDrawingCanvas() {
        drawingCanvas = document.getElementById('drawing-canvas');
        if (!drawingCanvas) {
            console.error('Canvas not found');
            return;
        }
        
        drawingCtx = drawingCanvas.getContext('2d');
        
        // ØªØ¹ÙŠÙŠÙ† Ø­Ø¬Ù… Ø§Ù„Ù„ÙˆØ­Ø©
        const container = drawingCanvas.parentElement;
        drawingCanvas.width = container.clientWidth;
        drawingCanvas.height = 600;
        
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        drawingCtx.lineCap = 'round';
        drawingCtx.lineJoin = 'round';
        drawingCtx.strokeStyle = currentDrawingColor;
        drawingCtx.lineWidth = currentBrushSize;
        drawingCtx.fillStyle = '#f9f9f9';
        drawingCtx.fillRect(0, 0, drawingCanvas.width, drawingCanvas.height);
        
        // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø§ÙˆØ³
        setupCanvasEvents();
        
        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø­Ø¬Ù… Ø§Ù„ÙØ±Ø´Ø§Ø©
        document.getElementById('brush-size-value').textContent = currentBrushSize;
        
        console.log('Canvas initialized successfully');
    }

    function setupCanvasEvents() {
        drawingCanvas.addEventListener('mousedown', startDrawing);
        drawingCanvas.addEventListener('mousemove', draw);
        drawingCanvas.addEventListener('mouseup', stopDrawing);
        drawingCanvas.addEventListener('mouseout', stopDrawing);
        
        // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù„Ù…Ø³ Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø©
        drawingCanvas.addEventListener('touchstart', function(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            drawingCanvas.dispatchEvent(mouseEvent);
        });
        
        drawingCanvas.addEventListener('touchmove', function(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            drawingCanvas.dispatchEvent(mouseEvent);
        });
        
        drawingCanvas.addEventListener('touchend', function(e) {
            e.preventDefault();
            const mouseEvent = new MouseEvent('mouseup', {});
            drawingCanvas.dispatchEvent(mouseEvent);
        });
    }

    function startDrawing(e) {
        isDrawing = true;
        const rect = drawingCanvas.getBoundingClientRect();
        lastX = e.clientX - rect.left;
        lastY = e.clientY - rect.top;
        
        if (currentShape) {
            isDrawingShape = true;
            startX = lastX;
            startY = lastY;
        } else {
            drawingCtx.beginPath();
            drawingCtx.moveTo(lastX, lastY);
        }
        
        // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
        document.getElementById('drawing-welcome').style.display = 'none';
    }

    function draw(e) {
        if (!isDrawing) return;
        
        const rect = drawingCanvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        if (isDrawingShape) {
            // Ù…Ø³Ø­ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ…
            redrawSavedCanvas();
            
            // Ø±Ø³Ù… Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            drawingCtx.strokeStyle = currentDrawingColor;
            drawingCtx.lineWidth = currentBrushSize;
            drawingCtx.beginPath();
            
            if (currentShape === 'rect') {
                const width = x - startX;
                const height = y - startY;
                drawingCtx.rect(startX, startY, width, height);
            } else if (currentShape === 'circle') {
                const radius = Math.sqrt(Math.pow(x - startX, 2) + Math.pow(y - startY, 2));
                drawingCtx.arc(startX, startY, radius, 0, Math.PI * 2);
            } else if (currentShape === 'line') {
                drawingCtx.moveTo(startX, startY);
                drawingCtx.lineTo(x, y);
            }
            
            drawingCtx.stroke();
        } else {
            drawingCtx.lineTo(x, y);
            drawingCtx.stroke();
            [lastX, lastY] = [x, y];
        }
    }

    function stopDrawing() {
        if (isDrawingShape) {
            isDrawingShape = false;
            // Ø­ÙØ¸ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
            saveCanvasState();
        }
        isDrawing = false;
        drawingCtx.beginPath();
        
        // Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ù„ÙˆØ­Ø©
        saveCanvasState();
    }

    function saveCanvasState() {
        savedDrawing = drawingCanvas.toDataURL();
    }

    function redrawSavedCanvas() {
        if (savedDrawing) {
            const img = new Image();
            img.onload = function() {
                drawingCtx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
                drawingCtx.fillStyle = '#f9f9f9';
                drawingCtx.fillRect(0, 0, drawingCanvas.width, drawingCanvas.height);
                drawingCtx.drawImage(img, 0, 0);
            };
            img.src = savedDrawing;
        }
    }

    function setActiveTool(tool) {
        currentDrawingTool = tool;
        currentShape = tool;
        
        // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Øª
        document.querySelectorAll('.drawing-tool-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        document.querySelectorAll('.shape-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        if (tool === 'pen') {
            document.getElementById('pen-tool').classList.add('active');
            drawingCtx.strokeStyle = currentDrawingColor;
            drawingCtx.lineWidth = currentBrushSize;
            currentShape = '';
        } else if (tool === 'eraser') {
            document.getElementById('eraser-tool').classList.add('active');
            drawingCtx.strokeStyle = '#f9f9f9';
            drawingCtx.lineWidth = currentBrushSize * 2;
            currentShape = '';
        } else if (tool === 'rect') {
            document.getElementById('rect-tool').classList.add('active');
        } else if (tool === 'circle') {
            document.getElementById('circle-tool').classList.add('active');
        } else if (tool === 'line') {
            document.getElementById('line-tool').classList.add('active');
        }
    }

    function selectColor(color) {
        currentDrawingColor = color;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        document.querySelectorAll('.color-dot').forEach(dot => {
            dot.classList.remove('selected');
        });
        event.target.classList.add('selected');
        
        if (currentDrawingTool === 'pen') {
            drawingCtx.strokeStyle = color;
        }
    }

    function updateBrushSize(size) {
        currentBrushSize = parseInt(size);
        document.getElementById('brush-size-value').textContent = size;
        drawingCtx.lineWidth = currentBrushSize;
        if (currentDrawingTool === 'eraser') {
            drawingCtx.lineWidth = currentBrushSize * 2;
        }
    }

    function clearDrawingCanvas() {
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ')) {
            drawingCtx.fillStyle = '#f9f9f9';
            drawingCtx.fillRect(0, 0, drawingCanvas.width, drawingCanvas.height);
            savedDrawing = null;
            document.getElementById('drawing-welcome').style.display = 'block';
        }
    }

    function saveDrawingToWhatsApp() {
        if (isCanvasEmpty()) {
            alert('Ø§Ù„Ø±Ø³Ù… ÙØ§Ø±ØºØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø±Ø³Ù… Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }
        
        const imageData = drawingCanvas.toDataURL('image/png');
        const message = encodeURIComponent(currentData.drawing_whatsapp_message || 'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ Ø£ÙˆØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø±Ø³Ù… Ø§Ù„ØªØ®Ø·ÙŠØ·ÙŠ:');
        const whatsappNum = currentData.whatsapp_num || '966500000000';
        
        const instruction = `
        ğŸ“± Ø®Ø·ÙˆØ§Øª Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ù…:
        
        1. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ù…" Ø£ÙˆÙ„Ø§Ù‹
        2. Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨
        3. Ø£Ø±Ø³Ù„ Ù„Ù†Ø§ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø¹ Ø´Ø±Ø­ Ù„ÙÙƒØ±ØªÙƒ
        
        Ø´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒ Ø¨Ù†Ø§! âœ¨
        `;
        
        if (confirm(instruction)) {
            // ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨
            window.open(`https://wa.me/${whatsappNum}?text=${message}`, '_blank');
        }
    }

    function downloadDrawing() {
        if (isCanvasEmpty()) {
            alert('Ø§Ù„Ø±Ø³Ù… ÙØ§Ø±ØºØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø±Ø³Ù… Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }
        
        const link = document.createElement('a');
        link.download = `ØªØµÙ…ÙŠÙ…-Ø¨ØµÙ…Ø©-ØºÙŠØ±-${Date.now()}.png`;
        link.href = drawingCanvas.toDataURL('image/png');
        link.click();
        
        alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­');
    }

    function isCanvasEmpty() {
        if (!drawingCanvas) return true;
        
        const blank = document.createElement('canvas');
        blank.width = drawingCanvas.width;
        blank.height = drawingCanvas.height;
        const blankCtx = blank.getContext('2d');
        blankCtx.fillStyle = '#f9f9f9';
        blankCtx.fillRect(0, 0, blank.width, blank.height);
        
        return drawingCanvas.toDataURL() === blank.toDataURL();
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ==========
    function checkAccess() {
        const userInput = prompt("ğŸ” Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:");
        if (userInput === "123456") {
            isAdmin = true;
            document.getElementById('admin-panel').style.display = 'block';
            document.getElementById('protection-toggle').style.display = 'flex';
        }
    }

    function toggleProtection() {
        alert('Ø®Ø§ØµÙŠØ© Ø§Ù„Ø­Ù…Ø§ÙŠØ©');
    }
</script>
</body>
</html>
