<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بصمة غير - الإدارة الاحترافية</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --primary: #111; --accent: #c5a059; --light: #fdfdfd; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--light); margin: 0; padding: 0; text-align: right; }
        header { background: var(--primary); color: white; padding: 30px 20px; text-align: center; border-bottom: 5px solid var(--accent); }
        .main-nav { display: flex; justify-content: center; background: #1a1a1a; padding: 10px; position: sticky; top: 0; z-index: 1000; gap: 8px; flex-wrap: wrap; }
        .nav-link { background: none; border: 1px solid var(--accent); color: var(--accent); padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .nav-link.active { background: var(--accent); color: white; }
        .page-section { max-width: 1200px; margin: 30px auto; padding: 0 20px; display: none; }
        .page-section.active { display: block; }
        .items-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .item-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-bottom: 3px solid var(--accent); text-align: center; }
        .item-card img { width: 100%; height: 250px; object-fit: cover; background: #eee; }
        .item-info { padding: 15px; }
        .react-btn { border: 1px solid #ddd; background: white; padding: 5px 10px; border-radius: 20px; cursor: pointer; margin: 5px; }
        #adminPanel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 9999; overflow-y: auto; padding: 20px; box-sizing: border-box; }
        .admin-box { background: #f4f4f4; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #ddd; }
        input, select { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 16px; }
        .btn-action { background: var(--accent); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; width: 100%; font-weight: bold; }
        .admin-toggle { position: fixed; bottom: 20px; left: 20px; background: var(--primary); color: white; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 10000; }
    </style>
</head>
<body>

<header>
    <h1>بصمة غير للديكور</h1>
    <p>نظام الإدارة المتكامل</p>
</header>

<div class="main-nav" id="navBar">
    <button class="nav-link active" onclick="showSec('about')">نبذة عنا</button>
    <button class="nav-link" onclick="showSec('works')">أعمالنا</button>
</div>

<section id="aboutSec" class="page-section active">
    <div style="background:white; padding:40px; border-radius:15px; text-align:center;">
        <h2 style="color:var(--accent)">من نحن</h2>
        <p id="aboutTxt">جاري التحميل...</p>
    </div>
</section>

<section id="worksSec" class="page-section">
    <div id="albumsList" class="items-grid"></div>
</section>

<section id="albumViewer" class="page-section">
    <button onclick="showSec('works')" style="margin-bottom:20px; cursor:pointer; padding:10px;">⬅ رجوع للأعمال</button>
    <h2 id="viewingTitle" style="text-align:center; color:var(--accent)"></h2>
    <div id="albumPhotos" class="items-grid"></div>
</section>

<section id="dynamicSec" class="page-section">
    <h2 id="dynTitle" style="text-align:center; color:var(--accent)"></h2>
    <div id="dynGrid" class="items-grid"></div>
</section>

<div class="admin-toggle" onclick="openAdmin()">⚙️</div>

<div id="adminPanel">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:2px solid var(--accent); padding-bottom:10px;">
        <h2>لوحة التحكم</h2>
        <button onclick="closeAdmin()" style="background:red; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">إغلاق وحفظ</button>
    </div>

    <div class="admin-box">
        <h3 style="color:var(--accent)">1. إضافة صور لـ "أعمالنا" (نظام مجموعات)</h3>
        <select id="albSelect" onchange="toggleInp('albSelect','newAlbInp')">
            <option value="">-- اختر مجموعة موجودة --</option>
            <option value="NEW">+ إنشاء مجموعة جديدة</option>
        </select>
        <input type="text" id="newAlbInp" placeholder="اسم المجموعة الجديدة" style="display:none;">
        <input type="text" id="albUrls" placeholder="ضع روابط الصور هنا (افصل بينها بفاصلة ,)">
        <button class="btn-action" onclick="saveAlbum()">حفظ في المجموعات</button>
    </div>

    <div class="admin-box">
        <h3 style="color:var(--accent)">2. إضافة صور لـ "أقسامنا" (نظام مستقل)</h3>
        <select id="secSelect" onchange="toggleInp('secSelect','newSecInp')">
            <option value="">-- اختر قسماً موجوداً --</option>
            <option value="NEW">+ إنشاء قسم جديد</option>
        </select>
        <input type="text" id="newSecInp" placeholder="اسم القسم الجديد" style="display:none;">
        <input type="text" id="oneUrl" placeholder="رابط الصورة">
        <input type="text" id="oneDesc" placeholder="وصف الصورة">
        <button class="btn-action" onclick="saveSingle()" style="background:#007bff">حفظ في الأقسام</button>
    </div>

    <div class="admin-box">
        <input type="text" id="siteNameInp" placeholder="اسم الموقع">
        <textarea id="aboutInp" placeholder="نبذة عن الشركة" style="width:100%; height:80px;"></textarea>
        <button class="btn-action" onclick="saveSiteInfo()" style="background:#333;">حفظ معلومات الموقع</button>
    </div>

    <div class="admin-box">
        <h3>المحتوى الحالي (للحذف)</h3>
        <div id="deleteList"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC0hGvWzpb0UxA_RrYn-0PQKyaATXavEGY",
        authDomain: "mydecor-b29bd.firebaseapp.com",
        databaseURL: "https://mydecor-b29bd-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "mydecor-b29bd",
        storageBucket: "mydecor-b29bd.appspot.com",
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let siteData = { info: {}, albums: {}, singles: [] };

    // جلب البيانات مع التأكد من المسار
    db.ref('basma_permanent_v1').on('value', snap => {
        const val = snap.val();
        if(val) {
            siteData = val;
            renderAll();
        }
    });

    function renderAll() {
        // نصوص الموقع
        document.getElementById('aboutTxt').innerText = siteData.info?.about || "اكتب نبذة من لوحة التحكم";
        
        // تحديث النافبار والقوائم المنسدلة
        const nav = document.getElementById('navBar');
        const albSel = document.getElementById('albSelect');
        const secSel = document.getElementById('secSelect');
        
        nav.innerHTML = '<button class="nav-link active" onclick="showSec(\'about\')">نبذة عنا</button><button class="nav-link" onclick="showSec(\'works\')">أعمالنا</button>';
        albSel.innerHTML = '<option value="">-- اختر مجموعة موجودة --</option><option value="NEW">+ إنشاء مجموعة جديدة</option>';
        secSel.innerHTML = '<option value="">-- اختر قسماً موجوداً --</option><option value="NEW">+ إنشاء قسم جديد</option>';

        // معالجة المجموعات (أعمالنا)
        const albList = document.getElementById('albumsList');
        albList.innerHTML = '';
        if(siteData.albums) {
            Object.keys(siteData.albums).forEach(k => {
                const a = siteData.albums[k];
                albSel.innerHTML += `<option value="${k}">${a.name}</option>`;
                albList.innerHTML += `<div class="item-card" onclick="viewAlb('${k}')"><img src="${a.images[0]}"><div class="item-info"><h3>${a.name}</h3></div></div>`;
            });
        }

        // معالجة الأقسام (مستقلة)
        const delList = document.getElementById('deleteList');
        delList.innerHTML = '';
        let cats = [...new Set((siteData.singles || []).map(s => s.cat))];
        cats.forEach(c => {
            nav.innerHTML += `<button class="nav-link" onclick="showDyn('${c}')">${c}</button>`;
            secSel.innerHTML += `<option value="${c}">${c}</option>`;
        });

        // قائمة الحذف في الإدارة
        (siteData.singles || []).forEach((s, i) => {
            delList.innerHTML += `<div style="border-bottom:1px solid #ccc; padding:5px;">[قسم: ${s.cat}] ${s.desc} <button onclick="delSingle(${i})" style="color:red">حذف</button></div>`;
        });
    }

    function toggleInp(selId, inpId) {
        document.getElementById(inpId).style.display = (document.getElementById(selId).value === 'NEW') ? 'block' : 'none';
    }

    function saveAlbum() {
        const sel = document.getElementById('albSelect').value;
        const newName = document.getElementById('newAlbInp').value;
        const urls = document.getElementById('albUrls').value.split(',').map(u => u.trim()).filter(u => u !== "");

        if(sel === 'NEW' && newName) {
            db.ref('basma_permanent_v1/albums').push({ name: newName, images: urls });
        } else if(sel && sel !== 'NEW') {
            const existing = siteData.albums[sel].images || [];
            db.ref('basma_permanent_v1/albums/' + sel + '/images').set([...existing, ...urls]);
        }
        alert("تم الحفظ بنجاح!");
    }

    function saveSingle() {
        const sel = document.getElementById('secSelect').value;
        const newCat = document.getElementById('newSecInp').value;
        const url = document.getElementById('oneUrl').value;
        const desc = document.getElementById('oneDesc').value;
        
        let cat = (sel === 'NEW') ? newCat : sel;
        if(!cat || !url) return alert("البيانات ناقصة");

        const singles = siteData.singles || [];
        singles.push({ cat, desc, img: url, likes: 0, id: Date.now() });
        db.ref('basma_permanent_v1/singles').set(singles);
        alert("تمت الإضافة للقسم!");
    }

    function showDyn(cat) {
        showSec('dynamic');
        document.getElementById('dynTitle').innerText = cat;
        const grid = document.getElementById('dynGrid');
        grid.innerHTML = '';
        siteData.singles.filter(s => s.cat === cat).forEach(s => {
            grid.innerHTML += `<div class="item-card"><img src="${s.img}"><div class="item-info"><p>${s.desc}</p>
            <button class="react-btn" onclick="react(${s.id})">❤️ ${s.likes || 0}</button></div></div>`;
        });
    }

    function viewAlb(id) {
        showSec('albumViewer');
        const alb = siteData.albums[id];
        document.getElementById('viewingTitle').innerText = alb.name;
        const grid = document.getElementById('albumPhotos');
        grid.innerHTML = '';
        alb.images.forEach(img => {
            grid.innerHTML += `<div class="item-card"><img src="${img}"></div>`;
        });
    }

    function showSec(id) {
        document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
        document.getElementById(id + 'Sec')?.classList.add('active');
        if(id === 'dynamic') document.getElementById('dynamicSec').classList.add('active');
        if(id === 'albumViewer') document.getElementById('albumViewer').classList.add('active');
    }

    function saveSiteInfo() {
        const about = document.getElementById('aboutInp').value;
        db.ref('basma_permanent_v1/info').update({ about });
        alert("تم التحديث");
    }

    function delSingle(i) { if(confirm("حذف؟")) { siteData.singles.splice(i,1); db.ref('basma_permanent_v1/singles').set(siteData.singles); } }
    function react(id) {
        const i = siteData.singles.findIndex(s => s.id === id);
        siteData.singles[i].likes = (siteData.singles[i].likes || 0) + 1;
        db.ref('basma_permanent_v1/singles').set(siteData.singles);
    }
    function openAdmin() { if(prompt("الباسورد:") === "1234") document.getElementById('adminPanel').style.display = 'block'; }
    function closeAdmin() { document.getElementById('adminPanel').style.display = 'none'; }
</script>
</body>
</html>
