<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بصمة غير للديكور - لوحة التحكم الشاملة</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <style>
        :root { --primary: #111; --accent: #c5a059; --light: #fdfdfd; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--light); margin: 0; padding: 0; color: #333; }
        
        /* الهيدر والتنقل */
        header { background: var(--primary); color: white; padding: 40px 20px; text-align: center; border-bottom: 5px solid var(--accent); }
        header h1 { margin: 0; color: var(--accent); font-size: 2.5rem; }
        .nav-bar { display: flex; justify-content: center; background: #1a1a1a; padding: 10px; sticky; top: 0; z-index: 1000; gap: 15px; }
        .nav-btn { background: none; border: 1px solid var(--accent); color: var(--accent); padding: 10px 25px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .nav-btn.active { background: var(--accent); color: white; }

        /* المحتوى */
        .content-section { max-width: 1200px; margin: 40px auto; padding: 20px; display: none; }
        .content-section.active { display: block; }
        
        /* قسم نبذة عنا */
        #aboutContent { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); text-align: center; line-height: 1.8; }

        /* قسم أعمالنا (الألبومات) */
        .album-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .album-card { background: white; border-radius: 12px; overflow: hidden; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-bottom: 4px solid var(--accent); }
        .album-card:hover { transform: translateY(-5px); }
        .album-card img { width: 100%; height: 250px; object-fit: cover; }
        .album-info { padding: 15px; text-align: center; }

        /* عرض الصور داخل الألبوم */
        .photo-viewer { display: none; }
        .photo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-top: 20px; }
        .photo-item { border-radius: 8px; overflow: hidden; height: 300px; }
        .photo-item img { width: 100%; height: 100%; object-fit: cover; }

        /* لوحة التحكم */
        #adminBox { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 25px; border-radius: 20px; box-shadow: 0 0 100px rgba(0,0,0,0.8); z-index: 5000; width: 90%; max-width: 650px; max-height: 85vh; overflow-y: auto; }
        .overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index: 4000; }
        .admin-block { background: #f8f8f8; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #eee; }
        input, textarea, select { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; }
        .btn-main { background: var(--accent); color: white; width: 100%; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        
        /* شريط التقدم */
        .progress-box { width: 100%; background: #eee; height: 15px; border-radius: 10px; margin: 10px 0; display: none; position: relative; }
        .progress-fill { height: 100%; background: var(--accent); width: 0%; border-radius: 10px; transition: 0.2s; }
        
        .admin-toggle { position: fixed; bottom: 20px; left: 20px; width: 45px; height: 45px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0.2; }
    </style>
</head>
<body>

<header>
    <h1 id="siteTitle">بصمة غير للديكور</h1>
    <p id="siteSubtitle">نصمم لك الجمال</p>
</header>

<div class="nav-bar">
    <button class="nav-btn active" onclick="showTab('about')">نبذة عنا</button>
    <button class="nav-btn" onclick="showTab('works')">أعمالنا</button>
</div>

<section id="aboutTab" class="content-section active">
    <div id="aboutContent">
        <h2 id="aboutHead">من نحن</h2>
        <p id="aboutBody">جاري التحميل...</p>
    </div>
</section>

<section id="worksTab" class="content-section">
    <div id="albumsGrid" class="album-grid"></div>
</section>

<section id="photoViewer" class="content-section photo-viewer">
    <button onclick="showTab('works')" style="margin-bottom:20px; cursor:pointer;">⬅ رجوع للأعمال</button>
    <h2 id="viewerTitle" style="color:var(--accent)"></h2>
    <div id="photosList" class="photo-grid"></div>
</section>

<div class="overlay" id="overlay" onclick="closeAdmin()"></div>

<div id="adminBox">
    <h2 style="text-align:center; color:var(--accent)">إدارة الموقع</h2>

    <div class="admin-block">
        <h4>1. الاسم والعبارة والنبذة</h4>
        <input type="text" id="inTitle" placeholder="اسم الموقع">
        <input type="text" id="inSub" placeholder="العبارة أسفل الاسم">
        <textarea id="inAbout" rows="3" placeholder="نبذة عن الشركة"></textarea>
        <button class="btn-main" onclick="saveInfo()">تحديث المعلومات العامة</button>
    </div>

    <div class="admin-block">
        <h4>2. إضافة "مجموعة أعمال" جديدة</h4>
        <input type="text" id="inAlbumName" placeholder="اسم المجموعة (مثلاً: معارض أحذية)">
        <textarea id="inAlbumDesc" placeholder="وصف بسيط للمجموعة"></textarea>
        <label>اختر صور المجموعة (رفع جماعي):</label>
        <input type="file" id="inFiles" multiple accept="image/*">
        
        <div class="progress-box" id="pBox"><div class="progress-fill" id="pFill"></div></div>
        <p id="pText" style="text-align:center; font-size:12px;"></p>

        <button class="btn-main" id="upBtn" onclick="uploadAlbum()">رفع المجموعة كاملة</button>
    </div>

    <div class="admin-block">
        <h4>المجموعات الحالية</h4>
        <div id="adminAlbumsList"></div>
    </div>
</div>

<div class="admin-toggle" onclick="authAdmin()">⚙️</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC0hGvWzpb0UxA_RrYn-0PQKyaATXavEGY",
        authDomain: "mydecor-b29bd.firebaseapp.com",
        databaseURL: "https://mydecor-b29bd-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "mydecor-b29bd",
        storageBucket: "mydecor-b29bd.appspot.com",
        messagingSenderId: "302609299720",
        appId: "1:302609299720:web:e086b600c3ee824acd54bd"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const storage = firebase.storage();

    let siteData = { info: {}, albums: [] };

    // جلب البيانات
    db.ref('basma_data').on('value', (snap) => {
        const d = snap.val();
        if(d) {
            siteData = d;
            renderUI();
        }
    });

    function renderUI() {
        // تحديث النصوص
        document.getElementById('siteTitle').innerText = siteData.info.title || "بصمة غير";
        document.getElementById('siteSubtitle').innerText = siteData.info.subtitle || "";
        document.getElementById('aboutBody').innerText = siteData.info.about || "";
        
        // تحديث شبكة الألبومات (أعمالنا)
        const grid = document.getElementById('albumsGrid');
        grid.innerHTML = '';
        const albums = siteData.albums || {};
        Object.keys(albums).forEach(id => {
            const alb = albums[id];
            grid.innerHTML += `
                <div class="album-card" onclick="viewAlbum('${id}')">
                    <img src="${alb.cover}">
                    <div class="album-info">
                        <h3>${alb.name}</h3>
                        <p>${alb.desc}</p>
                    </div>
                </div>`;
        });

        // قائمة الحذف في الإدارة
        const adminList = document.getElementById('adminAlbumsList');
        adminList.innerHTML = '';
        Object.keys(albums).forEach(id => {
            adminList.innerHTML += `<div style="display:flex; justify-content:space-between; padding:5px; border-bottom:1px solid #eee;">
                <span>${albums[id].name}</span>
                <button onclick="deleteAlb('${id}')" style="color:red; cursor:pointer; border:none; background:none;">حذف</button>
            </div>`;
        });
    }

    async function uploadAlbum() {
        const name = document.getElementById('inAlbumName').value;
        const desc = document.getElementById('inAlbumDesc').value;
        const files = document.getElementById('inFiles').files;

        if(!name || files.length === 0) return alert("أكمل البيانات");

        const btn = document.getElementById('upBtn');
        const pBox = document.getElementById('pBox');
        const pFill = document.getElementById('pFill');
        const pText = document.getElementById('pText');

        btn.disabled = true;
        pBox.style.display = 'block';

        let urls = [];
        for(let i=0; i < files.length; i++) {
            const f = files[i];
            const ref = storage.ref(`albums/${name}/${Date.now()}_${f.name}`);
            const task = ref.put(f);

            // مراقبة النسبة المئوية
            task.on('state_changed', (s) => {
                let p = Math.round((s.bytesTransferred / s.totalBytes) * 100);
                pText.innerText = `جاري رفع صورة ${i+1} من ${files.length} (${p}%)`;
                pFill.style.width = p + '%';
            });

            await task;
            const url = await ref.getDownloadURL();
            urls.push(url);
        }

        const newKey = db.ref('basma_data/albums').push().key;
        await db.ref('basma_data/albums/' + newKey).set({
            name: name,
            desc: desc,
            cover: urls[0], // أول صورة هي الغلاف
            images: urls
        });

        btn.disabled = false;
        pBox.style.display = 'none';
        alert("تم رفع المجموعة بنجاح");
        document.getElementById('inAlbumName').value = '';
        document.getElementById('inFiles').value = '';
    }

    function viewAlbum(id) {
        const alb = siteData.albums[id];
        showTab('none');
        document.getElementById('photoViewer').classList.add('active');
        document.getElementById('viewerTitle').innerText = alb.name;
        const list = document.getElementById('photosList');
        list.innerHTML = '';
        alb.images.forEach(img => {
            list.innerHTML += `<div class="photo-item"><img src="${img}"></div>`;
        });
    }

    function showTab(tab) {
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        if(tab === 'about') {
            document.getElementById('aboutTab').classList.add('active');
            document.querySelectorAll('.nav-btn')[0].classList.add('active');
        } else if(tab === 'works') {
            document.getElementById('worksTab').classList.add('active');
            document.querySelectorAll('.nav-btn')[1].classList.add('active');
        }
    }

    function saveInfo() {
        const title = document.getElementById('inTitle').value;
        const sub = document.getElementById('inSub').value;
        const about = document.getElementById('inAbout').value;
        db.ref('basma_data/info').update({ title, subtitle: sub, about });
        alert("تم حفظ البيانات");
    }

    function deleteAlb(id) { if(confirm("حذف المجموعة؟")) db.ref('basma_data/albums/' + id).remove(); }
    function authAdmin() { if(prompt("الباسورد:") === "1234") { document.getElementById('adminBox').style.display='block'; document.getElementById('overlay').style.display='block'; } }
    function closeAdmin() { document.getElementById('adminBox').style.display='none'; document.getElementById('overlay').style.display='none'; }
</script>
</body>
</html>
