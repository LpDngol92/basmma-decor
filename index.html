<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>بصمة غير | v28</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;800;900&display=swap');
        
        :root {
            --primary: #c5a059; /* ذهبي افتراضي */
            --bg: #000000;
            --card-bg: rgba(25, 25, 25, 0.9);
        }

        /* ستايل العنابي */
        [data-theme="burgundy"] {
            --primary: #800000;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        body { font-family: 'Tajawal', sans-serif; background: var(--bg); color: #fff; overflow-x: hidden; }

        /* أنيميشن الصيانة */
        #maintenance-screen {
            position: fixed; inset: 0; background: #000; z-index: 999999;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        .hammer-ani { font-size: 60px; color: var(--primary); animation: hammer-hit 0.8s infinite; margin-bottom: 20px; }
        @keyframes hammer-hit { 0%, 100% { transform: rotate(0deg); } 50% { transform: rotate(-45deg); } }
        .m-text { font-size: 1.5rem; font-weight: 900; color: var(--primary); text-align: center; padding: 0 20px; }

        /* الشركاء */
        .partners-section { 
            height: 35vh; display: flex; flex-direction: column; align-items: center; justify-content: center; 
            background: linear-gradient(to bottom, #0d0d0d, #000); /* داكنة */
            box-shadow: inset 0 0 40px rgba(0,0,0,0.8); border-bottom: 1px solid var(--primary);
        }
        .p-title { color: var(--primary); font-weight: 900; font-size: 1.3rem; }
        .fancy-line { width: 150px; height: 1px; background: linear-gradient(90deg, transparent, var(--primary), transparent); position: relative; margin: 10px 0 20px; }
        .fancy-line::after { content: '◈'; position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: #000; padding: 0 10px; color: var(--primary); }

        .partner-img { max-height: 120px; max-width: 80%; filter: drop-shadow(0 0 10px rgba(255,255,255,0.1)); }

        nav { position: sticky; top: 0; z-index: 1000; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); padding: 12px; display: flex; gap: 10px; overflow-x: auto; border-bottom: 1px solid var(--primary); }
        .nav-btn { padding: 8px 22px; border: none; background: rgba(255,255,255,0.05); color: #fff; border-radius: 40px; font-weight: 800; white-space: nowrap; transition: 0.3s; }
        .nav-btn.active { background: var(--primary); box-shadow: 0 0 15px var(--primary); }

        .sec { padding: 20px; display: none; }
        .sec.active { display: block; }
        .grid { display: grid; gap: 15px; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); }
        .card { background: var(--card-bg); border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); transition: 0.3s; }
        .card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .btn-order { width: 100%; padding: 12px; background: var(--primary); color: #fff; border: none; font-weight: 800; cursor: pointer; }

        /* لوحة الإدارة */
        #admin-panel { display: none; position: fixed; inset: 0; background: #000; z-index: 2000000; padding: 15px; overflow-y: auto; }
        .admin-box { border: 1px solid var(--primary); padding: 15px; border-radius: 12px; margin-bottom: 15px; background: #050505; }
        .theme-switch { display: flex; gap: 10px; margin-bottom: 15px; }
        .t-btn { flex: 1; padding: 12px; border: 1px solid var(--primary); border-radius: 8px; text-align: center; cursor: pointer; font-weight: 800; }
        
        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0; background: #111; border: 1px solid #333; color: #fff; border-radius: 8px; }
        .save-btn { background: var(--primary); color: #fff; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: 900; margin-top: 10px; }
    </style>
</head>
<body data-theme="gold">

<div id="maintenance-screen">
    <div class="hammer-ani"><i class="fas fa-hammer"></i></div>
    <div class="m-text" id="m-text-display">نحن نقوم ببعض التحسينات.. نعود قريباً</div>
</div>

<div class="partners-section">
    <div class="p-title" id="p-title-view">شركاء النجاح</div>
    <div class="fancy-line"></div>
    <div id="p-slider" style="height:120px; display:flex; align-items:center; justify-content:center;"></div>
</div>

<nav id="navbar"></nav>

<div id="content-area"></div>

<div id="admin-panel">
    <h2 style="color:var(--primary); text-align:center; margin-bottom:20px;">لوحة تحكم بصمة غير</h2>
    
    <div class="admin-box">
        <p style="margin-bottom:10px;">اختر الاستايل:</p>
        <div class="theme-switch">
            <div class="t-btn" style="color:#c5a059;" onclick="setTheme('gold')">الاستايل الذهبي</div>
            <div class="t-btn" style="color:#800000;" onclick="setTheme('burgundy')">الاستايل العنابي</div>
        </div>
    </div>

    <div class="admin-box">
        <h3>إعدادات الموقع</h3>
        <label><input type="checkbox" id="m-mode"> تفعيل وضع الصيانة</label>
        <input type="text" id="m-text-in" placeholder="رسالة الصيانة">
        <button class="save-btn" onclick="saveSettings()">حفظ الإعدادات</button>
    </div>

    <div class="admin-box">
        <h3>إدارة المحتوى</h3>
        <select id="target-page"></select>
        <textarea id="img-links" placeholder="روابط الصور (رابط في كل سطر)"></textarea>
        <button class="save-btn" style="background:#27ae60;" onclick="uploadPhotos()">نشر الصور</button>
    </div>

    <button onclick="location.reload()" style="width:100%; padding:15px; background:#444; color:#fff; border:none; border-radius:8px;">خروج</button>
</div>

<div onclick="checkAdmin()" style="position:fixed; bottom:0; left:0; width:40px; height:40px; z-index:3000000;"></div>

<script>
    const firebaseConfig = { databaseURL: "https://mydecor-b29bd-default-rtdb.europe-west1.firebasedatabase.app" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const PATH = 'site_v28';

    let currentData = {};
    let currentTab = 'home';
    let pIdx = 0;

    // جلب البيانات الأساسي
    db.ref(PATH).on('value', snap => {
        currentData = snap.val() || {};
        
        // تطبيق الثيم
        document.body.setAttribute('data-theme', currentData.theme || 'gold');

        // الصيانة
        if(currentData.maintenance_mode) {
            document.getElementById('maintenance-screen').style.display = 'flex';
            document.getElementById('m-text-display').innerText = currentData.maintenance_text || 'نحن قيد الصيانة';
        } else {
            document.getElementById('maintenance-screen').style.display = 'none';
        }

        renderSite();
        updateAdminLists();
        startPartners();
    });

    function renderSite() {
        // الأقسام (Navbar)
        let navHtml = `<button class="nav-btn ${currentTab==='home'?'active':''}" onclick="go('home')">الرئيسية</button>`;
        if(currentData.pages) {
            Object.keys(currentData.pages).forEach(id => {
                navHtml += `<button class="nav-btn ${currentTab===id?'active':''}" onclick="go('${id}')">${currentData.pages[id].title}</button>`;
            });
        }
        navHtml += `<button class="nav-btn ${currentTab==='works'?'active':''}" onclick="go('works')">أعمالنا</button>`;
        document.getElementById('navbar').innerHTML = navHtml;

        // المحتوى
        let contentHtml = `<div class="sec ${currentTab==='home'?'active':''}"><h2 style="text-align:center; margin-top:50px;">بصمة غير للتصميم</h2></div>`;
        
        if(currentData.pages) {
            Object.keys(currentData.pages).forEach(id => {
                contentHtml += `<div class="sec ${currentTab===id?'active':''}"><div class="grid">${drawImgs(currentData.pages[id].imgs)}</div></div>`;
            });
        }

        // ألبومات أعمالنا
        contentHtml += `<div class="sec ${currentTab==='works'?'active':''}"><div class="grid">${drawAlbums(currentData.albums)}</div></div>`;
        
        // داخل كل ألبوم
        if(currentData.albums) {
            Object.keys(currentData.albums).forEach(id => {
                contentHtml += `<div class="sec ${currentTab==='alb-'+id?'active':''}"><button onclick="go('works')" style="color:var(--primary); background:none; border:none; font-weight:bold; margin-bottom:15px;">← العودة</button><div class="grid">${drawImgs(currentData.albums[id].imgs)}</div></div>`;
            });
        }

        document.getElementById('content-area').innerHTML = contentHtml;
    }

    function drawImgs(imgs) {
        if(!imgs) return '<p style="text-align:center; width:100%;">لا توجد صور حالياً</p>';
        return Object.keys(imgs).reverse().map(id => `
            <div class="card">
                <img src="${imgs[id].url}" style="width:100%; aspect-ratio:1/1; object-fit:cover;">
                <button class="btn-order" onclick="window.open('https://wa.me/${currentData.whatsapp_num || ''}')">اطلب الآن</button>
            </div>
        `).join('');
    }

    function drawAlbums(albs) {
        if(!albs) return '';
        return Object.keys(albs).map(id => `
            <div class="card" onclick="go('alb-${id}')" style="padding:40px; text-align:center; cursor:pointer; border: 2px solid var(--primary);">
                <h3>${albs[id].name}</h3>
            </div>
        `).join('');
    }

    function go(id) { currentTab = id; renderSite(); }

    function startPartners() {
        if(!currentData.partners) return;
        const keys = Object.keys(currentData.partners);
        const container = document.getElementById('p-slider');
        
        setInterval(() => {
            const url = currentData.partners[keys[pIdx]].url;
            container.innerHTML = `<img src="${url}" class="partner-img" style="animation: fadeIn 1s">`;
            pIdx = (pIdx + 1) % keys.length;
        }, 3000);
    }

    function checkAdmin() {
        const p = prompt("الرمز:");
        db.ref('server_auth/lek').once('value', s => {
            if(p === s.val()) document.getElementById('admin-panel').style.display = 'block';
        });
    }

    function setTheme(t) { db.ref(PATH).update({ theme: t }); }

    function saveSettings() {
        db.ref(PATH).update({
            maintenance_mode: document.getElementById('m-mode').checked,
            maintenance_text: document.getElementById('m-text-in').value
        }).then(() => alert("تم الحفظ"));
    }

    function updateAdminLists() {
        let opts = '<option value="">-- اختر الوجهة --</option>';
        if(currentData.pages) Object.keys(currentData.pages).forEach(id => opts += `<option value="pages/${id}">${currentData.pages[id].title}</option>`);
        if(currentData.albums) Object.keys(currentData.albums).forEach(id => opts += `<option value="albums/${id}">${currentData.albums[id].name}</option>`);
        document.getElementById('target-page').innerHTML = opts;
    }

    function uploadPhotos() {
        const path = document.getElementById('target-page').value;
        const urls = document.getElementById('img-links').value.split('\n').filter(u => u.trim());
        if(!path || urls.length === 0) return alert("اختر وجهة وضع روابط");
        urls.forEach(u => db.ref(`${PATH}/${path}/imgs`).push({ url: u }));
        alert("تم النشر");
    }
</script>
</body>
</html>
