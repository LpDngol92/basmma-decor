<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨ØµÙ…Ø© ØºÙŠØ± Ù„Ù„Ø¯ÙŠÙƒÙˆØ± - Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    
    <style>
        :root { --primary: #111; --accent: #c5a059; --light: #fdfdfd; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--light); margin: 0; padding: 0; color: #333; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        header { background: var(--primary); color: white; padding: 40px 20px; text-align: center; border-bottom: 5px solid var(--accent); }
        header h1 { margin: 0; font-size: 2.5rem; color: var(--accent); }
        header p { opacity: 0.8; margin-bottom: 20px; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù‘Ù„ ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ù… */
        .nav-tabs { display: flex; justify-content: center; background: #1a1a1a; padding: 10px; flex-wrap: wrap; gap: 10px; position: sticky; top: 0; z-index: 1000; }
        .tab-btn { background: none; border: 1px solid var(--accent); color: var(--accent); padding: 8px 25px; border-radius: 5px; cursor: pointer; transition: 0.3s; font-weight: bold; }
        .tab-btn.active { background: var(--accent); color: white; }

        /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .section-content { max-width: 1400px; margin: 40px auto; padding: 0 20px; display: none; }
        .section-content.active { display: block; }

        #aboutSection { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); text-align: center; line-height: 1.8; }

        /* Ø´Ø¨ÙƒØ© Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ */
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; margin-top: 20px; }
        .item-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.05); transition: 0.4s; position: relative; }
        .item-card img { width: 100%; height: 380px; object-fit: cover; border-bottom: 2px solid #eee; }
        
        .reaction-bar { display: flex; justify-content: center; gap: 15px; padding: 15px; background: #fafafa; }
        .react-btn { background: white; border: 1px solid #ddd; padding: 6px 15px; border-radius: 20px; cursor: pointer; transition: 0.2s; font-size: 0.9rem; display: flex; align-items: center; gap: 5px; }
        .react-btn:hover { background: var(--accent); color: white; border-color: var(--accent); }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #adminBox { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 20px; box-shadow: 0 0 100px rgba(0,0,0,0.8); z-index: 5000; width: 95%; max-width: 700px; max-height: 90vh; overflow-y: auto; }
        .overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index: 4000; }
        .admin-section { background: #f9f9f9; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #eee; }
        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-family: inherit; }
        .btn-save { background: var(--accent); color: white; width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem; }
        
        .admin-toggle { position: fixed; bottom: 20px; left: 20px; width: 45px; height: 45px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 6000; opacity: 0.3; }
        .upload-area { border: 2px dashed var(--accent); padding: 30px; text-align: center; background: #fffcf5; margin: 10px 0; border-radius: 10px; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <h1 id="dispTitle">Ø¨ØµÙ…Ø© ØºÙŠØ± Ù„Ù„Ø¯ÙŠÙƒÙˆØ±</h1>
    <p id="dispSubtitle">Ù†ØµÙ…Ù… Ù„Ùƒ Ø§Ù„Ø¬Ù…Ø§Ù„ ÙÙŠ ÙƒÙ„ Ø²Ø§ÙˆÙŠØ©</p>
</header>

<div class="nav-tabs" id="tabsBar">
    <button class="tab-btn active" id="btn-about" onclick="switchSection('about')">Ù†Ø¨Ø°Ø© Ø¹Ù†Ø§</button>
</div>

<div id="aboutSectionContent" class="section-content active">
    <div id="aboutSection">
        <h2 id="aboutTitleDisp">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ…</h2>
        <div id="aboutTextDisp">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
    </div>
</div>

<div id="gallerySectionContent" class="section-content">
    <h2 id="currentCategoryTitle" style="text-align:center; color:var(--accent); margin-bottom:30px;"></h2>
    <div class="gallery-grid" id="mainGallery"></div>
</div>

<div class="overlay" id="overlay" onclick="closeAdmin()"></div>

<div id="adminBox">
    <h2 style="text-align:center; color:var(--accent);">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</h2>

    <div class="admin-section">
        <h4>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ø§Ù…Ø©</h4>
        <input type="text" id="editTitle" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹">
        <textarea id="editAbout" rows="3" placeholder="Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ø´Ø±ÙƒØ©"></textarea>
        <button class="btn-save" onclick="saveGeneralInfo()" style="background:#444;">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¹Ø§Ù…Ø©</button>
    </div>

    <div class="admin-section">
        <h4 style="color:var(--accent);">Ø¥Ø¯Ø§Ø±Ø© Ù‚Ø³Ù… "Ø£Ø¹Ù…Ø§Ù„Ù†Ø§" (Ø±ÙØ¹ Ø¬Ù…Ø§Ø¹ÙŠ ÙÙˆØ±ÙŠ)</h4>
        
        <label>Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… (Ù…Ø«Ù„: Ù…Ø¹Ø§Ø±Ø¶ Ø£Ø­Ø°ÙŠØ©):</label>
        <div style="display:flex; gap:10px;">
            <input type="text" id="newCatInput" placeholder="Ø§Ø³Ù… Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯">
            <select id="catDropdown" style="flex:2;"><option value="">Ø£Ùˆ Ø§Ø®ØªØ± Ù‚Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯</option></select>
        </div>

        <div class="upload-area" onclick="document.getElementById('batchUploadInput').click()">
            <label>Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„ØªØ­Ø¯ÙŠØ¯ ØµÙˆØ± ÙƒØ«ÙŠØ±Ø© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ Ù„Ù„Ø±ÙØ¹ ÙÙˆØ±Ø§Ù‹</label>
            <input type="file" id="batchUploadInput" multiple accept="image/*" style="display:none">
        </div>

        <button class="btn-save" id="upBtn" onclick="doBatchUpload()">Ø¨Ø¯Ø¡ Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ù…ØªÙˆØ§Ø²ÙŠ Ø§Ù„Ø³Ø±ÙŠØ¹</button>
        <div id="upProgress" style="display:none; text-align:center; margin-top:15px; font-weight:bold; color:var(--accent);"></div>
    </div>

    <div class="admin-section">
        <h4>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©</h4>
        <div id="adminItemsList" style="max-height: 180px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; font-size: 13px; background: white;"></div>
    </div>

    <button onclick="closeAdmin()" style="width:100%; padding:10px; background:none; border:none; cursor:pointer; color:#888;">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù„ÙˆØ­Ø©</button>
</div>

<div class="admin-toggle" onclick="checkAuth()">âš™ï¸</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC0hGvWzpb0UxA_RrYn-0PQKyaATXavEGY",
        authDomain: "mydecor-b29bd.firebaseapp.com",
        databaseURL: "https://mydecor-b29bd-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "mydecor-b29bd",
        storageBucket: "mydecor-b29bd.appspot.com",
        messagingSenderId: "302609299720",
        appId: "1:302609299720:web:e086b600c3ee824acd54bd"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const storage = firebase.storage();

    let products = [];
    let categories = [];
    let siteInfo = { title: "Ø¨ØµÙ…Ø© ØºÙŠØ± Ù„Ù„Ø¯ÙŠÙƒÙˆØ±", about: "Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…ÙˆÙ‚Ø¹Ù†Ø§" };

    db.ref('site_data').on('value', (snap) => {
        const data = snap.val();
        if(data) {
            products = data.products || [];
            categories = data.categories || [];
            siteInfo = data.siteInfo || siteInfo;
            refreshUI();
        }
    });

    // Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ù…ØªÙˆØ§Ø²ÙŠ ÙØ§Ø¦Ù‚ Ø§Ù„Ø³Ø±Ø¹Ø©
    async function doBatchUpload() {
        const files = document.getElementById('batchUploadInput').files;
        const catName = document.getElementById('newCatInput').value.trim() || document.getElementById('catDropdown').value;
        
        if(!catName) return alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… (Ø£Ø­Ø°ÙŠØ©ØŒ Ø³ÙˆØ¨Ø±Ù…Ø§Ø±ÙƒØª..)");
        if(files.length === 0) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ± Ø£ÙˆÙ„Ø§Ù‹");

        const progress = document.getElementById('upProgress');
        const btn = document.getElementById('upBtn');
        progress.style.display = 'block';
        btn.disabled = true;
        progress.innerText = `Ø¨Ø¯Ø¡ Ø±ÙØ¹ ${files.length} ØµÙˆØ±Ø© ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª...`;

        // ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ù…ØªÙˆØ§Ø²ÙŠ Ù„ÙØªØ­ ÙƒÙ„ Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø±ÙØ¹ Ù…Ø¹Ø§Ù‹
        const uploadPromises = Array.from(files).map(async (file, index) => {
            try {
                const timestamp = Date.now();
                const ref = storage.ref(`works/${catName}/${timestamp}_${index}_${file.name}`);
                const uploadTask = await ref.put(file);
                const url = await uploadTask.ref.getDownloadURL();

                return {
                    id: timestamp + index,
                    img: url,
                    cat: catName,
                    likes: 0,
                    dislikes: 0
                };
            } catch (err) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØµÙˆØ±Ø©:", err);
                return null;
            }
        });

        const results = await Promise.all(uploadPromises);
        const successfulOnes = results.filter(item => item !== null);
        
        products = [...products, ...successfulOnes];
        if(!categories.includes(catName)) categories.push(catName);

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ù„ØªÙˆÙÙŠØ± Ø§Ù„ÙˆÙ‚Øª
        await db.ref('site_data').set({ products, categories, siteInfo });
        
        progress.innerText = "âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ø³Ø±ÙŠØ¹ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ±!";
        document.getElementById('batchUploadInput').value = "";
        document.getElementById('newCatInput').value = "";
        btn.disabled = false;
        setTimeout(() => progress.style.display = 'none', 3000);
    }

    function refreshUI() {
        document.getElementById('dispTitle').innerText = siteInfo.title;
        document.getElementById('aboutTextDisp').innerText = siteInfo.about;

        const tabsBar = document.getElementById('tabsBar');
        let tabsHtml = `<button class="tab-btn active" id="btn-about" onclick="switchSection('about')">Ù†Ø¨Ø°Ø© Ø¹Ù†Ø§</button>`;
        categories.forEach(cat => {
            tabsHtml += `<button class="tab-btn" onclick="switchSection('gallery', '${cat}')">${cat}</button>`;
        });
        tabsBar.innerHTML = tabsHtml;

        const dropdown = document.getElementById('catDropdown');
        dropdown.innerHTML = '<option value="">Ø£Ùˆ Ø§Ø®ØªØ± Ù‚Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯</option>';
        categories.forEach(cat => dropdown.innerHTML += `<option value="${cat}">${cat}</option>`);

        const list = document.getElementById('adminItemsList');
        list.innerHTML = '';
        products.slice().reverse().forEach(p => {
            list.innerHTML += `<div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #eee; align-items:center;">
                <span>[${p.cat}] - ØµÙˆØ±Ø© Ù…Ø±ÙÙˆØ¹Ø©</span>
                <button onclick="deleteItem(${p.id})" style="color:red; background:none; border:none; cursor:pointer; font-weight:bold;">Ø­Ø°Ù</button>
            </div>`;
        });
    }

    function switchSection(type, catName = '') {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.section-content').forEach(s => s.classList.remove('active'));

        if(type === 'about') {
            document.getElementById('aboutSectionContent').classList.add('active');
            document.getElementById('btn-about').classList.add('active');
        } else {
            document.getElementById('gallerySectionContent').classList.add('active');
            document.getElementById('currentCategoryTitle').innerText = "Ø£Ø¹Ù…Ø§Ù„Ù†Ø§ ÙÙŠ " + catName;
            
            // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø®ØªØ§Ø±
            const btns = document.querySelectorAll('.tab-btn');
            btns.forEach(b => { if(b.innerText === catName) b.classList.add('active'); });

            const gallery = document.getElementById('mainGallery');
            gallery.innerHTML = '';
            products.filter(p => p.cat === catName).forEach(p => {
                gallery.innerHTML += `
                    <div class="item-card">
                        <img src="${p.img}">
                        <div class="reaction-bar">
                            <button class="react-btn" onclick="addReaction(${p.id}, 'likes')">ğŸ‘ <span>${p.likes || 0}</span></button>
                            <button class="react-btn" onclick="addReaction(${p.id}, 'dislikes')">ğŸ‘ <span>${p.dislikes || 0}</span></button>
                        </div>
                    </div>`;
            });
        }
    }

    function addReaction(id, type) {
        const idx = products.findIndex(p => p.id === id);
        if(idx !== -1) {
            products[idx][type] = (products[idx][type] || 0) + 1;
            db.ref('site_data/products').set(products);
        }
    }

    function deleteItem(id) {
        if(confirm("Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø©ØŸ")) {
            products = products.filter(p => p.id !== id);
            db.ref('site_data/products').set(products);
        }
    }

    function saveGeneralInfo() {
        siteInfo.title = document.getElementById('editTitle').value || siteInfo.title;
        siteInfo.about = document.getElementById('editAbout').value || siteInfo.about;
        db.ref('site_data/siteInfo').set(siteInfo);
        alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ Ø¨Ù†Ø¬Ø§Ø­");
    }

    function checkAuth() { if(prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:") === "1234") { document.getElementById('adminBox').style.display='block'; document.getElementById('overlay').style.display='block'; } }
    function closeAdmin() { document.getElementById('adminBox').style.display='none'; document.getElementById('overlay').style.display='none'; }
</script>

</body>
</html>
